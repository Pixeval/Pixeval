<controls:EnhancedPage
    x:Class="Pixeval.Pages.IllustrationViewer.IllustrationViewerPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:Pixeval.Controls"
    xmlns:controls1="using:CommunityToolkit.WinUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:flyoutContent="using:Pixeval.Controls.FlyoutContent"
    xmlns:illustrationViewer="using:Pixeval.Pages.IllustrationViewer"
    xmlns:interactivity="using:Microsoft.Xaml.Interactivity"
    xmlns:labs="using:CommunityToolkit.Labs.WinUI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    KeyboardAcceleratorPlacementMode="Hidden"
    Loaded="IllustrationViewerPage_OnLoaded"
    mc:Ignorable="d">
    <controls:EnhancedPage.Resources>
        <AcrylicBrush
            x:Key="BottomCommandSectionBackground"
            FallbackColor="{StaticResource SecondaryAccentColor}"
            TintColor="{StaticResource SecondaryAccentColor}"
            TintLuminosityOpacity="0.8"
            TintOpacity="0.8" />
    </controls:EnhancedPage.Resources>
    <controls:EnhancedPage.KeyboardAccelerators>
        <KeyboardAccelerator Key="Left" Invoked="PrevButton_OnClicked" />
        <KeyboardAccelerator Key="Right" Invoked="NextButton_OnClicked" />
        <KeyboardAccelerator Key="Up" Invoked="PrevButton_OnRightTapped" />
        <KeyboardAccelerator Key="Down" Invoked="NextButton_OnRightTapped" />
    </controls:EnhancedPage.KeyboardAccelerators>
    <Grid>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="48" />
            </Grid.RowDefinitions>
            <controls:WorkViewerSplitView
                x:Name="EntryViewerSplitView"
                Grid.Row="1"
                MenuItemsSource="{x:Bind _viewModel.Tags, Mode=OneWay}">
                <controls:WorkViewerSplitView.PaneContent>
                    <ListView
                        x:Name="ImagesListView"
                        Padding="24"
                        ItemsSource="{x:Bind _viewModel.Images, Mode=OneWay}"
                        SelectionMode="None">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="illustrationViewer:ImageViewerPageViewModel">
                                <Grid>
                                    <labs:Shimmer Margin="4" Visibility="{x:Bind controls:C.ToVisibilityNegation(LoadSuccessfully), Mode=OneWay}" />
                                    <Image Source="{x:Bind DisplayImageSource, Mode=OneWay}" />
                                    <ProgressRing
                                        Width="50"
                                        Height="50"
                                        Margin="0,192"
                                        IsIndeterminate="{x:Bind controls:C.IsZeroD(LoadingProgress), Mode=OneWay}"
                                        Visibility="{x:Bind controls:C.ToVisibilityNegation(LoadSuccessfully), Mode=OneWay}"
                                        Value="{x:Bind LoadingProgress, Mode=OneWay}" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                </controls:WorkViewerSplitView.PaneContent>
            </controls:WorkViewerSplitView>
            <ContentPresenter x:Name="OuterTopBarPresenter" Grid.Row="0" />
            <controls:AdvancedItemsView
                x:Name="ThumbnailItemsView"
                Grid.Row="2"
                Margin="5"
                Padding="0,0,0,15"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                ItemsSource="{x:Bind _viewModel.Illustrations}"
                LayoutType="HorizontalStack"
                MinItemHeight="80"
                MinItemWidth="80"
                PreviewKeyDown="ThumbnailItemsView_OnPreviewKeyDown"
                SelectedIndex="{x:Bind _viewModel.CurrentIllustrationIndex, Mode=TwoWay}"
                SelectionMode="Single"
                Visibility="{x:Bind controls:C.ToVisibility(_viewModel.IsBottomListOpen), Mode=OneWay}">
                <controls:AdvancedItemsView.ItemTemplate>
                    <DataTemplate x:DataType="controls:IllustrationItemViewModel">
                        <ItemContainer Width="80" Height="80">
                            <controls:LazyImage
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                DataContext="{x:Bind}"
                                DataContextChanged="FrameworkElement_OnDataContextChanged"
                                Source="{x:Bind ThumbnailSource, Mode=OneWay}" />
                        </ItemContainer>
                    </DataTemplate>
                </controls:AdvancedItemsView.ItemTemplate>
                <controls:AdvancedItemsView.ItemTransitionProvider>
                    <LinedFlowLayoutItemCollectionTransitionProvider />
                </controls:AdvancedItemsView.ItemTransitionProvider>
            </controls:AdvancedItemsView>
            <Grid
                Grid.Row="3"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Background="{ThemeResource LayerOnMicaBaseAltFillColorDefaultBrush}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" MaxWidth="310" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <CommandBar
                    Grid.Column="0"
                    HorizontalAlignment="Stretch"
                    DefaultLabelPosition="Collapsed">
                    <AppBarToggleButton Command="{x:Bind _viewModel.InfoAndCommentsCommand}" IsChecked="{x:Bind EntryViewerSplitView.IsPaneOpen, Mode=TwoWay}" />
                    <AppBarToggleButton Command="{x:Bind _viewModel.BottomListCommand}" IsChecked="{x:Bind _viewModel.IsBottomListOpen, Mode=TwoWay}" />
                    <AppBarSeparator />
                    <controls:AppBarTextItem
                        Padding="15,0"
                        Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                        Symbol="AppTitle"
                        Text="{x:Bind _viewModel.CurrentIllustration.Entry.Title, Mode=OneWay}" />
                </CommandBar>
                <CommandBar
                    x:Name="ExtensionsCommandBar"
                    Grid.Column="2"
                    HorizontalAlignment="Stretch"
                    DefaultLabelPosition="Collapsed"
                    Visibility="{x:Bind controls:C.ToVisibilityNegation(_viewModel.CurrentIllustration.IsUgoira), Mode=OneWay}" />
            </Grid>
        </Grid>
    </Grid>
</controls:EnhancedPage>
