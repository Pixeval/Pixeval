<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <OutputType>WinExe</OutputType>
        <TargetFramework>net8.0-windows10.0.22621.0</TargetFramework>
        <TargetPlatformMinVersion>10.0.19041.0</TargetPlatformMinVersion>
        <RootNamespace>Pixeval</RootNamespace>
        <Configurations>Debug;Release</Configurations>
        <Platforms>x86;x64;arm64</Platforms>
        <RuntimeIdentifiers>win-x86;win-x64;win-arm64</RuntimeIdentifiers>
        <ApplicationManifest>app.manifest</ApplicationManifest>
        <UseWinUI>true</UseWinUI>
        <Nullable>enable</Nullable>
        <EnableNETAnalyzers>false</EnableNETAnalyzers>
        <EnablePreviewFeatures>true</EnablePreviewFeatures>
        <ApplicationIcon></ApplicationIcon>
        <StartupObject>Pixeval.Program</StartupObject>
        <EnablePreviewMsixTooling>true</EnablePreviewMsixTooling>
        <RestorePackagesWithLockFile>true</RestorePackagesWithLockFile>
        <EnableDefaultPriItems>false</EnableDefaultPriItems>
        <DefaultLanguage>zh-cn</DefaultLanguage>
        <AppxPackageSigningEnabled Condition="'$(Configuration)' == 'Release'">true</AppxPackageSigningEnabled>
        <AppxPackageSigningEnabled Condition="'$(Configuration)' == 'Debug'">false</AppxPackageSigningEnabled>
        <RunAnalyzersDuringBuild>false</RunAnalyzersDuringBuild>
        <LangVersion>preview</LangVersion>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
        <NoWarn>$(NoWarn)</NoWarn>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="CommunityToolkit.Labs.WinUI.Controls.MarkdownTextBlock" Version="0.1.240229-build.1650" />
        <PackageReference Include="CommunityToolkit.Labs.WinUI.Shimmer" Version="0.1.240229-build.1650" />
        <PackageReference Include="CommunityToolkit.WinUI.Behaviors" Version="8.0.240109" />
        <PackageReference Include="CommunityToolkit.WinUI.Collections" Version="8.0.240109" />
        <PackageReference Include="CommunityToolkit.WinUI.Animations" Version="8.0.240109" />
        <PackageReference Include="CommunityToolkit.WinUI.Controls.Primitives" Version="8.0.240109" />
        <PackageReference Include="CommunityToolkit.WinUI.Controls.Segmented" Version="8.0.240109" />
        <PackageReference Include="CommunityToolkit.WinUI.Controls.SettingsControls" Version="8.0.240109" />
        <PackageReference Include="CommunityToolkit.WinUI.Controls.TokenizingTextBox" Version="8.0.240109" />
        <PackageReference Include="CommunityToolkit.WinUI.Converters" Version="8.0.240109" />
        <PackageReference Include="CommunityToolkit.WinUI.Media" Version="8.0.240109" />
        <PackageReference Include="CommunityToolkit.Diagnostics" Version="8.2.2" />
        <PackageReference Include="CommunityToolkit.Mvvm" Version="8.2.2" />
        <PackageReference Include="GitVersion.MsBuild" Version="5.12.0">
            <PrivateAssets>all</PrivateAssets>
            <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
        </PackageReference>
        <PackageReference Include="LiteDB" Version="5.0.19" />
        <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="8.0.0" />
        <PackageReference Include="Microsoft.IO.RecyclableMemoryStream" Version="3.0.0" />
        <PackageReference Include="Microsoft.Toolkit.Uwp.Notifications" Version="7.1.3" />
        <PackageReference Include="Microsoft.Windows.SDK.BuildTools" Version="10.0.22621.3233" />
        <PackageReference Include="Microsoft.WindowsAppSDK" Version="1.5.240227000" />
        <PackageReference Include="Microsoft.Xaml.Behaviors.WinUI.Managed" Version="2.0.9" />
        <PackageReference Include="PininSharp" Version="1.2.0" />
        <PackageReference Include="Pixeval.QRCoder" Version="1.4.5" />
        <PackageReference Include="ReverseMarkdown" Version="4.3.0" />
        <PackageReference Include="SixLabors.ImageSharp" Version="3.1.2" />
        <PackageReference Include="SixLabors.ImageSharp.Drawing" Version="2.1.1" />
        <PackageReference Include="System.Linq.Async" Version="6.0.1" />
        <PackageReference Include="WinUI3Utilities" Version="1.1.6.2" />

        <ProjectReference Include="..\Pixeval.Controls\Pixeval.Controls.csproj" />
        <ProjectReference Include="..\Pixeval.CoreApi\Pixeval.CoreApi.csproj" />
        <ProjectReference Include="..\Pixeval.Utilities\Pixeval.Utilities.csproj" />
        <ProjectReference Include="..\Pixeval.SourceGen\Pixeval.SourceGen.csproj" OutputItemType="Analyzer" ReferenceOutputAssembly="False" />
        <Manifest Include="$(ApplicationManifest)" />
    </ItemGroup>

    <!--Exposes PRI resources-->
    <Target Name="InjectAdditionalFiles" BeforeTargets="GenerateMSBuildEditorConfigFileShouldRun">
        <ItemGroup>
            <AdditionalFiles Include="@(PRIResource)" SourceItemGroup="PRIResource" />
        </ItemGroup>
    </Target>
    <ItemGroup>
        <CompilerVisibleItemMetadata Include="AdditionalFiles" MetadataName="SourceItemGroup" />
    </ItemGroup>

    <!--PackageManifest-->
    <PropertyGroup>
        <UpdateVersionProperties>true</UpdateVersionProperties>
        <IncludePackageReferencesDuringMarkupCompilation>true</IncludePackageReferencesDuringMarkupCompilation>
        <GitVersionTargetsBefore>$(GitVersionTargetsBefore);_ValidateWindowsPackageType</GitVersionTargetsBefore>
        <GenerateAppInstallerFile>True</GenerateAppInstallerFile>
        <AppxPackageSigningEnabled>True</AppxPackageSigningEnabled>
        <AppxPackageSigningTimestampDigestAlgorithm>SHA256</AppxPackageSigningTimestampDigestAlgorithm>
        <AppxAutoIncrementPackageRevision>False</AppxAutoIncrementPackageRevision>
        <AppxSymbolPackageEnabled>False</AppxSymbolPackageEnabled>
        <GenerateTestArtifacts>True</GenerateTestArtifacts>
        <AppxBundle>Never</AppxBundle>
        <AppInstallerUri>%UserProfile%\Desktop</AppInstallerUri>
        <HoursBetweenUpdateChecks>0</HoursBetweenUpdateChecks>
        <PackageCertificateThumbprint>7E324F18025670AFD5C06739776C17C8DDE2F8E6</PackageCertificateThumbprint>
    </PropertyGroup>

    <Target Name="PrepareForGenerateGitVersionInformation" BeforeTargets="GenerateGitVersionInformation">
        <MakeDir Directories="$(OutDir);$(IntermediateOutputPath);@(DocFileItem->'%(RelativeDir)');@(CreateDirectory)" ContinueOnError="True" />
        <ItemGroup Condition="'@(AppxManifest)'==''">
            <AppxManifest Include="Package.appxmanifest"></AppxManifest>
        </ItemGroup>
        <PropertyGroup>
            <WindowsPackageType>MSIX</WindowsPackageType>
        </PropertyGroup>
    </Target>

    <Target Name="GeneratePackageAppxManifest" BeforeTargets="_ValidateWindowsPackageType" DependsOnTargets="GetVersion">
        <PropertyGroup>
            <ManifestText>
                <![CDATA[<?xml version="1.0" encoding="utf-8"?>
                <Package xmlns="http://schemas.microsoft.com/appx/manifest/foundation/windows10"
                    xmlns:uap="http://schemas.microsoft.com/appx/manifest/uap/windows10"
                    xmlns:rescap="http://schemas.microsoft.com/appx/manifest/foundation/windows10/restrictedcapabilities" IgnorableNamespaces="uap rescap">
                    <Identity Name="9a360099-e513-45d0-b3f1-3e599691ea06" Publisher="CN=Pixeval" Version="]]>$(GitVersion_AssemblySemVer)<![CDATA[" />
                    <Properties>
                        <DisplayName>Pixeval</DisplayName>
                        <PublisherDisplayName>Pixeval</PublisherDisplayName>
                        <Logo>Assets\Images\Tiles\StoreLogo.png</Logo>
                    </Properties>
                    <Dependencies>
                        <TargetDeviceFamily Name="Windows.Universal" MinVersion="10.0.19041.0" MaxVersionTested="10.0.22621.0" />
                        <TargetDeviceFamily Name="Windows.Desktop" MinVersion="10.0.19041.0" MaxVersionTested="10.0.22621.0" />
                    </Dependencies>
                    <Resources>
                        <Resource Language="x-generate"/>
                    </Resources>
                    <Applications>
                        <Application Id="App" Executable="%24targetnametoken%24.exe" EntryPoint="%24targetentrypoint%24">
                            <uap:VisualElements DisplayName="Pixeval" Description="A fast, powerful and fully-functional third-party Pixiv client" BackgroundColor="transparent" Square150x150Logo="Assets\Images\Tiles\Square150x150Logo.png" Square44x44Logo="Assets\Images\Tiles\Square44x44Logo.png">
                                <uap:DefaultTile Wide310x150Logo="Assets\Images\Tiles\Wide310x150Logo.png" Square71x71Logo="Assets\Images\Tiles\SmallTile.png" Square310x310Logo="Assets\Images\Tiles\LargeTile.png">
                                    <uap:ShowNameOnTiles>
                                        <uap:ShowOn Tile="square150x150Logo"/>
                                        <uap:ShowOn Tile="wide310x150Logo"/>
                                        <uap:ShowOn Tile="square310x310Logo"/>
                                    </uap:ShowNameOnTiles>
                                </uap:DefaultTile >
                                <uap:SplashScreen Image="Assets\Images\Tiles\SplashScreen.png" />
                                <uap:LockScreen BadgeLogo="Assets\Images\Tiles\BadgeLogo.png" Notification="badgeAndTileText"/>
                                <uap:InitialRotationPreference>
                                    <uap:Rotation Preference="landscape"/>
                                    <uap:Rotation Preference="portrait"/>
                                </uap:InitialRotationPreference>
                            </uap:VisualElements>
                            <Extensions>
                                <uap:Extension Category="windows.protocol">
                                    <uap:Protocol Name="pixeval">
                                        <uap:DisplayName>Pixeval App Protocol</uap:DisplayName>
                                    </uap:Protocol>
                                </uap:Extension>
                            </Extensions>
                        </Application>
                    </Applications>
                    <Capabilities>
                        <rescap:Capability Name="runFullTrust" />
                        <Capability Name="internetClient"/>
                        <uap:Capability Name="picturesLibrary"/>
                        <Capability Name="codeGeneration"/>
                        <uap:Capability Name="removableStorage"/>
                    </Capabilities>
                </Package>]]>
            </ManifestText>
        </PropertyGroup>
        <WriteLinesToFile File="$(MSBuildProjectDirectory)\Package.appxmanifest" Overwrite="true" Lines="$(ManifestText)" />
    </Target>

    <!--PRIResource-->
    <ItemGroup>
        <PRIResource Include="Assets\Svg.resjson" />
        <PRIResource Include="Strings\zh-cn\CommentsPage.resjson" />
        <PRIResource Include="Strings\zh-cn\FollowingUserBadge.resjson" />
        <PRIResource Include="Strings\zh-cn\IllustratorContentViewer.resjson" />
        <PRIResource Include="Strings\zh-cn\BookmarksPage.resjson" />
        <PRIResource Include="Strings\zh-cn\IllustrateItem.resjson" />
        <PRIResource Include="Strings\zh-cn\AboutPage.resjson" />
        <PRIResource Include="Strings\zh-cn\Activations.resjson" />
        <PRIResource Include="Strings\zh-cn\CommentRepliesBlock.resjson" />
        <PRIResource Include="Strings\zh-cn\DownloadListEntry.resjson" />
        <PRIResource Include="Strings\zh-cn\DownloadListPage.resjson" />
        <PRIResource Include="Strings\zh-cn\DownloadListPageDeleteTasksDialog.resjson" />
        <PRIResource Include="Strings\zh-cn\DownloadTask.resjson" />
        <PRIResource Include="Strings\zh-cn\IllustrateView.resjson" />
        <PRIResource Include="Strings\zh-cn\IllustrationViewCommandBar.resjson" />
        <PRIResource Include="Strings\zh-cn\IllustrationInfoPage.resjson" />
        <PRIResource Include="Strings\zh-cn\IllustrationResultFilterContent.resjson" />
        <PRIResource Include="Strings\zh-cn\IllustrateViewerPage.resjson" />
        <PRIResource Include="Strings\zh-cn\IllustratorViewerPage.resjson" />
        <PRIResource Include="Strings\zh-cn\ImageViewerPage.resjson" />
        <PRIResource Include="Strings\zh-cn\LoginPage.resjson" />
        <PRIResource Include="Strings\zh-cn\MacroParser.resjson" />
        <PRIResource Include="Strings\zh-cn\MainPage.resjson" />
        <PRIResource Include="Strings\zh-cn\MessageContentDialog.resjson" />
        <PRIResource Include="Strings\zh-cn\Misc.resjson" />
        <PRIResource Include="Strings\zh-cn\RankingsPage.resjson" />
        <PRIResource Include="Strings\zh-cn\RecommendationsPage.resjson" />
        <PRIResource Include="Strings\zh-cn\PixivReplyBar.resjson" />
        <PRIResource Include="Strings\zh-cn\ReverseSearchApiKeyNotPresentDialog.resjson" />
        <PRIResource Include="Strings\zh-cn\SettingsPage.resjson" />
        <PRIResource Include="Strings\zh-cn\TokenInputTextBox.resjson" />
        <PRIResource Include="Strings\zh-cn\TagsEntry.resjson" />
        <PRIResource Include="Strings\zh-cn\IPListInput.resjson" />
    </ItemGroup>

    <!--XAML-->
    <ItemGroup>
        <None Remove="IllustrationContainer.xaml" />
        <None Remove="IPListInput.xaml" />
        <None Remove="PrivacyPolicyComboBox.xaml" />
        <None Remove="SettingRadioButtons.xaml" />
        <None Remove="SortOptionComboBox.xaml" />
        <None Remove="MainPage.xaml" />
        <None Remove="CommentBlock.xaml" />
        <None Remove="CommentList.xaml" />
        <None Remove="PixivReplyBar.xaml" />
        <None Remove="DownloadListPageDeleteTasksDialog.xaml" />
        <None Remove="TagsEntryEditTagDialog.xaml" />
        <None Remove="CommentRepliesBlock.xaml" />
        <None Remove="IllustrateView.xaml" />
        <None Remove="IllustrationItem.xaml" />
        <None Remove="IllustrationView.xaml" />
        <None Remove="IllustratorIllustrationsOverview.xaml" />
        <None Remove="IllustratorView.xaml" />
        <None Remove="TokenInput.xaml" />
        <None Remove="BookmarksPage.xaml" />
        <None Remove="FollowingsPage.xaml" />
        <None Remove="IllustratorIllustrationPage.xaml" />
        <None Remove="IllustratorMangaPage.xaml" />
        <None Remove="RankingsPage.xaml" />
        <None Remove="RecentPostsPage.xaml" />
        <None Remove="RecommendationPage.xaml" />
        <None Remove="RecommendUsersPage.xaml" />
        <None Remove="SearchResultsPage.xaml" />
        <None Remove="SpotlightsPage.xaml" />
        <None Remove="DownloadListEntry.xaml" />
        <None Remove="DownloadListPage.xaml" />
        <None Remove="CommentsPage.xaml" />
        <None Remove="IllustrationInfoPage.xaml" />
        <None Remove="IllustrationViewerPage.xaml" />
        <None Remove="ImageViewerPage.xaml" />
        <None Remove="PixivReplyEmojiListPage.xaml" />
        <None Remove="PixivReplyStickerListPage.xaml" />
        <None Remove="RelatedWorksPage.xaml" />
        <None Remove="IllustratorViewerPage.xaml" />
        <None Remove="LoginPage.xaml" />
        <None Remove="AboutPage.xaml" />
        <None Remove="BrowsingHistoryPage.xaml" />
        <None Remove="SettingsPage.xaml" />
        <None Remove="TagsEntry.xaml" />
        <None Remove="TagsPage.xaml" />
        <None Remove="IllustrationResultFilterContent.xaml" />
        <None Remove="IllustratorItem.xaml" />
        <None Remove="RecommendIllustratorItem.xaml" />

        <Page Update="Controls\IllustrationContainer.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\IPListInput.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\PrivacyPolicyComboBox.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\SettingRadioButtons.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\SortOptionComboBox.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\MainPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\Comment\CommentBlock.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\Comment\CommentList.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\Comment\PixivReplyBar.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\DialogContent\DownloadListPageDeleteTasksDialog.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\DialogContent\TagsEntryEditTagDialog.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\FlyoutContent\CommentRepliesBlock.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\Illustrate\IllustrateView.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\IllustrationItem\IllustrationItem.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\IllustrationView\IllustrationView.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\IllustratorItem\IllustratorIllustrationsOverview.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\IllustratorView\IllustratorView.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\TokenInput\TokenInput.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Capability\BookmarksPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Capability\FollowingsPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Capability\IllustratorIllustrationPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Capability\IllustratorMangaPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Capability\RankingsPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Capability\RecentPostsPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Capability\RecommendationPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Capability\RecommendUsersPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Capability\SearchResultsPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Capability\SpotlightsPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Download\DownloadListEntry.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Download\DownloadListPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\IllustrationViewer\CommentsPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\IllustrationViewer\IllustrationInfoPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\IllustrationViewer\IllustrationViewerPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\IllustrationViewer\ImageViewerPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\IllustrationViewer\PixivReplyEmojiListPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\IllustrationViewer\PixivReplyStickerListPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\IllustrationViewer\RelatedWorksPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\IllustratorViewer\IllustratorViewerPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Login\LoginPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Misc\AboutPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Misc\BrowsingHistoryPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Misc\SettingsPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Tags\TagsEntry.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Pages\Tags\TagsPage.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\FlyoutContent\IllustrationResultFilter\IllustrationResultFilterContent.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\IllustratorItem\IllustratorItem\IllustratorItem.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
        <Page Update="Controls\IllustratorItem\RecommendIllustratorItem\RecommendIllustratorItem.xaml">
            <Generator>MSBuild:Compile</Generator>
        </Page>
    </ItemGroup>
</Project>
