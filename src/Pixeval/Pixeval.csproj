<Project Sdk="Microsoft.NET.Sdk">
	<PropertyGroup>
		<OutputType>WinExe</OutputType>
		<TargetFramework>net7.0-windows10.0.19041.0</TargetFramework>
		<TargetPlatformMinVersion>10.0.17763.0</TargetPlatformMinVersion>
		<RootNamespace>Pixeval</RootNamespace>
		<Platforms>x86;x64;arm64</Platforms>
		<RuntimeIdentifiers>win10-x86;win10-x64;win10-arm64</RuntimeIdentifiers>
		<ApplicationManifest>app.manifest</ApplicationManifest>
		<UseWinUI>true</UseWinUI>
		<Nullable>enable</Nullable>
		<DefaultLanguage>zh-CN</DefaultLanguage>
		<EnablePreviewFeatures>true</EnablePreviewFeatures>
		<StartupObject>Pixeval.Program</StartupObject>
		<EnablePreviewMsixTooling>true</EnablePreviewMsixTooling>
		<RestorePackagesWithLockFile>true</RestorePackagesWithLockFile>
		<EnableDefaultPriItems>false</EnableDefaultPriItems>
		<NeutralLanguage>zh-CN</NeutralLanguage>
		<LangVersion>preview</LangVersion>
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
		<DefineConstants>$(DefineConstants);DISABLE_XAML_GENERATED_MAIN</DefineConstants>
	</PropertyGroup>

	<ItemGroup>
		<ProjectReference Include="..\Pixeval.CoreApi\Pixeval.CoreApi.csproj" />
		<ProjectReference Include="..\Pixeval.Navigation\Pixeval.Navigation.csproj" />
		<ProjectReference Include="..\Pixeval.SourceGen\Pixeval.SourceGen.csproj" OutputItemType="Analyzer" ReferenceOutputAssembly="false" />
	</ItemGroup>

	<ItemGroup>
		<PackageReference Include="CommunityToolkit.WinUI.Notifications" Version="7.1.2" />
		<PackageReference Include="CommunityToolkit.WinUI.UI.Animations" Version="7.1.2" />
		<PackageReference Include="CommunityToolkit.WinUI.UI.Behaviors" Version="7.1.2" />
		<PackageReference Include="CommunityToolkit.WinUI.UI.Controls" Version="7.1.2" />
		<PackageReference Include="CommunityToolkit.WinUI.UI.Media" Version="7.1.2" />
		<PackageReference Include="GitVersion.MsBuild" Version="5.11.1">
			<PrivateAssets>all</PrivateAssets>
			<IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
		</PackageReference>
		<PackageReference Include="LiteDB.Async" Version="0.1.2" />
		<PackageReference Include="Microsoft.Extensions.Hosting" Version="7.0.0" />
		<PackageReference Include="Microsoft.IO.RecyclableMemoryStream" Version="2.2.1" />
		<PackageReference Include="CommunityToolkit.Diagnostics" Version="8.1.0-preview3" />
		<PackageReference Include="CommunityToolkit.Mvvm" Version="8.1.0-preview3" />
		<PackageReference Include="Microsoft.VisualStudio.Threading" Version="17.4.27" />
		<PackageReference Include="Microsoft.VisualStudio.Threading.Analyzers" Version="17.4.27">
			<PrivateAssets>all</PrivateAssets>
			<IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
		</PackageReference>
		<PackageReference Include="Microsoft.Win32.Registry" Version="6.0.0-preview.5.21301.5" />
		<PackageReference Include="Microsoft.Windows.SDK.BuildTools" Version="10.0.25267-preview" />
		<PackageReference Include="Microsoft.WindowsAppSDK" Version="1.2.221209.1" />
		<PackageReference Include="Microsoft.Xaml.Behaviors.WinUI.Managed" Version="2.0.9" />
		<PackageReference Include="ReverseMarkdown" Version="3.24.0" />
		<PackageReference Include="SixLabors.ImageSharp" Version="2.1.3" />
		<PackageReference Include="SixLabors.ImageSharp.Drawing" Version="1.0.0-beta15" />
		<PackageReference Include="SkiaSharp.QrCode" Version="0.6.0" />
		<PackageReference Include="SkiaSharp.Views.WinUI" Version="2.88.3" />
		<PackageReference Include="System.Linq.Async" Version="6.0.1" />
		<PackageReference Include="System.Net.Http.Json" Version="7.0.0" />
		<PackageReference Include="WinUIEx" Version="2.0.0" />
		<Manifest Include="$(ApplicationManifest)" />
	</ItemGroup>

	<PropertyGroup>
		<UpdateVersionProperties>true</UpdateVersionProperties>
		<IncludePackageReferencesDuringMarkupCompilation>true</IncludePackageReferencesDuringMarkupCompilation>
		<GitVersionTargetsBefore>$(GitVersionTargetsBefore);_ValidateWindowsPackageType</GitVersionTargetsBefore>
	</PropertyGroup>

	<ItemGroup>
		<None Remove="Assets\Images\logo-no-caption.png" />
		<None Remove="Assets\Certs\pixeval_server_cert.pfx" />
		<None Remove="Assets\Fonts\Segoe Fluent Icons.ttf" />
		<None Remove="Assets\GPLv3.md" />
		<None Remove="Assets\Images\empty-box.theme-dark.png" />
		<None Remove="Assets\Images\empty-box.theme-light.png" />
		<None Remove="Assets\Images\logo44x44.ico" />
		<None Remove="Assets\Images\pixeval-mock.png" />
		<None Remove="LoginWindow.xaml" />
		<None Remove="Pages\BookMarksPage.xaml" />
		<None Remove="Pages\IllustrationGridPage.xaml" />
		<None Remove="Pages\IllustrationViewerPage.xaml" />
		<None Remove="Pages\ImageViewerPage.xaml" />
		<None Remove="Pages\RecommendationPage.xaml" />
		<None Remove="Pages\SettingsPage.xaml" />
		<None Remove="Strings\zh-CN\App.resw" />
		<None Remove="Strings\zh-CN\MainWindow.resw" />
		<None Remove="Themes\Card.xaml" />
		<None Remove="Themes\Controls.xaml" />
		<None Remove="Templates.xaml" />
		<None Remove="Themes.xaml" />
		<None Remove="Themes\Generic.xaml" />
	</ItemGroup>

	<!-- #region Exposes PRI resources to the source generator -->
	<Target Name="InjectAdditionalFiles" BeforeTargets="GenerateMSBuildEditorConfigFileShouldRun">
		<ItemGroup>
			<AdditionalFiles Include="@(PRIResource)" SourceItemGroup="PRIResource" />
		</ItemGroup>
	</Target>
	<ItemGroup>
		<CompilerVisibleItemMetadata Include="AdditionalFiles" MetadataName="SourceItemGroup" />
	</ItemGroup>
	<!-- #endregion Exposes PRI resources to the source generator -->


	<Target Name="PrepareForGenerateGitVersionInformation" BeforeTargets="GenerateGitVersionInformation">
		<MakeDir Directories="$(OutDir);$(IntermediateOutputPath);@(DocFileItem->'%(RelativeDir)');@(CreateDirectory)" ContinueOnError="True" />
		<ItemGroup Condition="'@(AppxManifest)'==''">
			<AppxManifest Include="Package.appxmanifest"></AppxManifest>
		</ItemGroup>
		<PropertyGroup>
			<WindowsPackageType>MSIX</WindowsPackageType>
		</PropertyGroup>
	</Target>

	<Target Name="GeneratePackageAppxManifest" BeforeTargets="_ValidateWindowsPackageType" DependsOnTargets="GetVersion">
		<PropertyGroup>
			<ManifestText>
				&lt;?xml version="1.0" encoding="utf-8"?&gt;
				&lt;Package
				xmlns="http://schemas.microsoft.com/appx/manifest/foundation/windows10"
				xmlns:uap="http://schemas.microsoft.com/appx/manifest/uap/windows10"
				xmlns:rescap="http://schemas.microsoft.com/appx/manifest/foundation/windows10/restrictedcapabilities"
				IgnorableNamespaces="uap rescap"&gt;
				&lt;Identity
				Name="9a360099-e513-45d0-b3f1-3e599691ea06"
				Publisher="CN=Pixeval"
				Version="$(GitVersion_AssemblySemVer)" /&gt;
				&lt;Properties&gt;
				&lt;DisplayName&gt;Pixeval&lt;/DisplayName&gt;
				&lt;PublisherDisplayName&gt;Pixeval&lt;/PublisherDisplayName&gt;
				&lt;Logo&gt;Assets\Images\Tiles\StoreLogo.png&lt;/Logo&gt;
				&lt;/Properties&gt;
				&lt;Dependencies&gt;
				&lt;TargetDeviceFamily Name="Windows.Universal" MinVersion="10.0.17763.0" MaxVersionTested="10.0.19041.0" /&gt;
				&lt;TargetDeviceFamily Name="Windows.Desktop" MinVersion="10.0.17763.0" MaxVersionTested="10.0.19041.0" /&gt;
				&lt;/Dependencies&gt;
				&lt;Resources&gt;
				&lt;Resource Language="x-generate"/&gt;
				&lt;/Resources&gt;
				&lt;Applications&gt;
				&lt;Application Id="App"
				Executable="%24targetnametoken%24.exe"
				EntryPoint="%24targetentrypoint%24"&gt;
				&lt;uap:VisualElements
				DisplayName="Pixeval"
				Description="A fast, powerful and fully-functional third-party Pixiv client"
				BackgroundColor="transparent"
				Square150x150Logo="Assets\Images\Tiles\Square150x150Logo.png"
				Square44x44Logo="Assets\Images\Tiles\Square44x44Logo.png"&gt;
				&lt;uap:DefaultTile Wide310x150Logo="Assets\Images\Tiles\Wide310x150Logo.png"  Square71x71Logo="Assets\Images\Tiles\SmallTile.png" Square310x310Logo="Assets\Images\Tiles\LargeTile.png"&gt;
				&lt;uap:ShowNameOnTiles&gt;
				&lt;uap:ShowOn Tile="square150x150Logo"/&gt;
				&lt;uap:ShowOn Tile="wide310x150Logo"/&gt;
				&lt;uap:ShowOn Tile="square310x310Logo"/&gt;
				&lt;/uap:ShowNameOnTiles&gt;
				&lt;/uap:DefaultTile &gt;
				&lt;uap:SplashScreen Image="Assets\Images\Tiles\SplashScreen.png" /&gt;
				&lt;uap:LockScreen BadgeLogo="Assets\Images\Tiles\BadgeLogo.png" Notification="badgeAndTileText"/&gt;
				&lt;uap:InitialRotationPreference&gt;
				&lt;uap:Rotation Preference="landscape"/&gt;
				&lt;uap:Rotation Preference="portrait"/&gt;&lt;/uap:InitialRotationPreference&gt;
				&lt;/uap:VisualElements&gt;
				&lt;Extensions&gt;
				&lt;uap:Extension Category="windows.protocol"&gt;
				&lt;uap:Protocol Name="pixeval"&gt;
				&lt;uap:DisplayName&gt;Pixeval App Protocol&lt;/uap:DisplayName&gt;
				&lt;/uap:Protocol&gt;
				&lt;/uap:Extension&gt;
				&lt;/Extensions&gt;
				&lt;/Application&gt;
				&lt;/Applications&gt;
				&lt;Capabilities&gt;
				&lt;rescap:Capability Name="runFullTrust" /&gt;
				&lt;Capability Name="internetClient"/&gt;
				&lt;uap:Capability Name="picturesLibrary"/&gt;
				&lt;Capability Name="codeGeneration"/&gt;
				&lt;uap:Capability Name="removableStorage"/&gt;
				&lt;/Capabilities&gt;
				&lt;/Package&gt;
			</ManifestText>
		</PropertyGroup>
		<WriteLinesToFile File="$(MSBuildProjectDirectory)\Package.appxmanifest" Overwrite="true" Lines="$(ManifestText)" />
	</Target>

	<ItemGroup>
		<Folder Include="Assets\Images\Supporters\" />
	</ItemGroup>

	<ItemGroup>
		<PRIResource Include="Strings\**\*.resw" />
	</ItemGroup>
	<ItemGroup>
		<Page Update="LoginWindow.xaml">
			<Generator>MSBuild:Compile</Generator>
		</Page>
	</ItemGroup>

	<!--  XAML  -->
	<ItemGroup>
		<Page Update="Pages\Capabilities\RecommendationPage.xaml">
			<Generator>MSBuild:Compile</Generator>
		</Page>
		<Page Update="Pages\MainPage.xaml">
			<Generator>MSBuild:Compile</Generator>
		</Page>
		<Page Update="Pages\Capabilities\RecommendationPage.xaml">
			<Generator>MSBuild:Compile</Generator>
		</Page>
		<Page Update="Pages\MainPage.xaml">
			<Generator>MSBuild:Compile</Generator>
		</Page>
		<Page Update="Themes\Generic.xaml">
			<Generator>MSBuild:Compile</Generator>
		</Page>
		<Page Update="Themes\Card.xaml">
			<Generator>MSBuild:Compile</Generator>
		</Page>
		<Page Update="Styles\Controls.xaml">
			<Generator>MSBuild:Compile</Generator>
		</Page>
		<Page Update="Styles\Colors.xaml">
			<Generator>MSBuild:Compile</Generator>
		</Page>
		<Page Update="Pages\Capabilities\BookmarksPage.xaml">
			<Generator>MSBuild:Compile</Generator>
		</Page>
	</ItemGroup>
</Project>